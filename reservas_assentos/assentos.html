<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./assentos.css" />
    <link rel="shortcut icon" type="img/png" href="img/onibus.png">
    <title>SEM PARADA | ASSENTOS</title>
</head>
<body>
    <header>

      <h1>SEM PARADA</h1>
      <nav class="menu">
        <a href="../index.html">PRINCIPAL</a>
        <a href="">OFERTAS</a>
        <a href="">HISTÓRICO</a>
        <a id="perfil" href=""
          >NOME
          <img
            src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png"
            alt="profile"
        /></a>
      </nav>
      
    </header>

    <main>

        <h1>Reservas de Passagens </h1>

    <div class="container">
        <div class="onibus-container">
            <div class="onibus-frente">FRENTE</div>
            
            <div id="mapa-assentos">
                </div>

            <div class="onibus-frente" >FUNDO</div> 
        </div>

        <div class="resumo-compra">
            <h2>Sua Seleção</h2>
            <ul id="assentos-selecionados">
                <li>Nenhum assento selecionado</li>
            </ul>
            <p id="total-valor">Total: R$ 0.00</p>
            <div class="botoes-acao">
                <button class="btn btn-comprar" id="btn-finalizar-compra">Finalizar Compra</button>
                <button class="btn btn-limpar" id="btn-limpar-selecao">Limpar Seleção</button>
            </div>
        </div>
    </div>

    <div class="legenda">
        <div class="legenda-item">
            <div class="legenda-cor legenda-disponivel"></div>
            <span>Disponível</span>
        </div>
        <div class="legenda-item">
            <div class="legenda-cor legenda-selecionado"></div>
            <span>Selecionado</span>
        </div>
        <div class="legenda-item">
            <div class="legenda-cor legenda-ocupado"></div>
            <span>Ocupado</span>
        </div>
    </div>

    <script>
// CONFIGURANDO O MAPA E O PREÇO DOS ASSENTOS
        const NUM_FILEIRAS = 8; // Número de fileiras no ônibus
        const ASSENTOS_POR_FILEIRA = 4; // Total de assentos por fileira (ex: A, B, C, D)
        const ASSENTOS_CORREDOR_ESQ = 2; // Quantos assentos antes do corredor (ex: A, B)
        const PRECO_ASSENTO_UNITARIO = 50.00; // Preço de cada assento

// Array para simular assentos inicialmente ocupados (ex: já comprados)
        const ASSENTOS_INICIAIS_OCUPADOS = ['1C', '2A', '5A', '5B', '8C'];


// VARIÁVEIS GLOBAIS E ELEMENTOS DO DOM              */
      
        const mapaAssentosDiv = document.getElementById('mapa-assentos');
        const assentosSelecionadosUl = document.getElementById('assentos-selecionados');
        const totalValorSpan = document.getElementById('total-valor');
        const btnFinalizarCompra = document.getElementById('btn-finalizar-compra');
        const btnLimparSelecao = document.getElementById('btn-limpar-selecao');

        let assentosAtualmenteSelecionados = []; // Armazena os IDs dos assentos selecionados
        let precoTotal = 0;

        
// FUNÇÕES PRINCIPAIS                                
  

        /**
         * Gera o mapa de assentos no HTML baseado nas configurações.
         */
        function gerarMapaAssentos() {
            mapaAssentosDiv.innerHTML = ''; // Limpa qualquer conteúdo existente

            for (let i = 1; i <= NUM_FILEIRAS; i++) {
                const fileiraDiv = document.createElement('div');
                fileiraDiv.classList.add('fileira');

                const grupoEsquerda = document.createElement('div');
                grupoEsquerda.classList.add('grupo-assentos');

                const grupoDireita = document.createElement('div');
                grupoDireita.classList.add('grupo-assentos');

                for (let j = 0; j < ASSENTOS_POR_FILEIRA; j++) {
                    // Mapeia o índice do assento para uma letra (A, B, C, D...)
                    const letraAssento = String.fromCharCode(65 + j); // 65 é o código ASCII para 'A'
                    const idAssento = `${i}${letraAssento}`; // Ex: "1A", "1B", "1C", "1D"

                    const assentoDiv = document.createElement('div');
                    assentoDiv.classList.add('assento');
                    assentoDiv.setAttribute('data-id', idAssento); // Armazena o ID no elemento para fácil acesso
                    assentoDiv.textContent = idAssento; // Exibe o ID dentro do assento

                    // Verifica se o assento deve ser inicialmente ocupado
                    if (ASSENTOS_INICIAIS_OCUPADOS.includes(idAssento)) {
                        assentoDiv.classList.add('ocupado');
                    } else {
                        // Adiciona o evento de clique apenas para assentos disponíveis
                        assentoDiv.addEventListener('click', () => toggleAssento(idAssento));
                    }

                    // Divide os assentos entre esquerda e direita para simular o corredor
                    if (j < ASSENTOS_CORREDOR_ESQ) {
                        grupoEsquerda.appendChild(assentoDiv);
                    } else {
                        grupoDireita.appendChild(assentoDiv);
                    }
                }
                
                fileiraDiv.appendChild(grupoEsquerda);
                fileiraDiv.appendChild(grupoDireita);
                mapaAssentosDiv.appendChild(fileiraDiv);
            }
        }

        /**
         * Adiciona ou remove um assento da seleção.
         * @param {string} id Assento a ser alternado.
         */
        function toggleAssento(id) {
            const assentoElement = document.querySelector(`.assento[data-id="${id}"]`);

            // Se o assento estiver ocupado, não faz nada
            if (assentoElement.classList.contains('ocupado')) {
                return;
            }

            // Alterna a classe 'selecionado'
            assentoElement.classList.toggle('selecionado');

            // Adiciona ou remove da lista de assentos selecionados
            if (assentoElement.classList.contains('selecionado')) {
                assentosAtualmenteSelecionados.push(id);
            } else {
                assentosAtualmenteSelecionados = assentosAtualmenteSelecionados.filter(item => item !== id);
            }

            atualizarResumoCompra();
        }

        /**
         * Remove um assento da lista de seleção no resumo e atualiza o mapa.
         * @param {string} id Assento a ser removido da seleção.
         */
        function removerAssentoDaSelecao(id) {
            const assentoElement = document.querySelector(`.assento[data-id="${id}"]`);
            if (assentoElement && assentoElement.classList.contains('selecionado')) {
                assentoElement.classList.remove('selecionado');
            }
            assentosAtualmenteSelecionados = assentosAtualmenteSelecionados.filter(item => item !== id);
            atualizarResumoCompra();
        }

        /**
         * Atualiza a lista de assentos selecionados no painel de resumo
         * e recalcula o valor total.
         */
        function atualizarResumoCompra() {
            assentosSelecionadosUl.innerHTML = ''; // Limpa a lista atual

            if (assentosAtualmenteSelecionados.length === 0) {
                const li = document.createElement('li');
                li.style.textAlign = 'center';
                li.style.color = '#777';
                li.textContent = 'Nenhum assento selecionado';
                assentosSelecionadosUl.appendChild(li);
                precoTotal = 0;
            } else {
                assentosAtualmenteSelecionados.sort((a, b) => { // Ordena para melhor visualização
                    const numA = parseInt(a.match(/\d+/)[0]);
                    const numB = parseInt(b.match(/\d+/)[0]);
                    if (numA !== numB) return numA - numB;
                    return a.localeCompare(b);
                });

                assentosAtualmenteSelecionados.forEach(id => {
                    const li = document.createElement('li');
                    li.innerHTML = `<span>Assento ${id}</span> 
                                    <button onclick="removerAssentoDaSelecao('${id}')">Remover</button>`;
                    assentosSelecionadosUl.appendChild(li);
                });

                precoTotal = assentosAtualmenteSelecionados.length * PRECO_ASSENTO_UNITARIO;
            }

            totalValorSpan.textContent = `Total: R$ ${precoTotal.toFixed(2).replace('.', ',')}`; // Formato monetário
        }

        /**
         * Simula a finalização da compra: marca os assentos como ocupados.
         */
        function finalizarCompra() {
            if (assentosAtualmenteSelecionados.length === 0) {
                alert('Por favor, selecione ao menos um assento para finalizar a compra.');
                return;
            }

            const confirmacao = confirm(`Deseja realmente comprar ${assentosAtualmenteSelecionados.length} assento(s) por R$ ${precoTotal.toFixed(2).replace('.', ',')}?`);

            if (confirmacao) {
                assentosAtualmenteSelecionados.forEach(id => {
                    const assentoElement = document.querySelector(`.assento[data-id="${id}"]`);
                    if (assentoElement) {
                        assentoElement.classList.remove('selecionado'); // Remove seleção
                        assentoElement.classList.add('ocupado');      // Marca como ocupado
                        // Remove o event listener para que não possa ser clicado novamente
                        assentoElement.removeEventListener('click', () => toggleAssento(id));
                    }
                });

                alert('Compra finalizada com sucesso! Seus assentos foram reservados!');
                assentosAtualmenteSelecionados = []; // Limpa a lista de selecionados
                atualizarResumoCompra(); // Atualiza o resumo
                // Em um sistema real, aqui você enviaria os dados para o backend
            }
        }

        /**
         * Limpa todos os assentos selecionados, sem finalizar a compra.
         */
        function limparSelecao() {
            if (assentosAtualmenteSelecionados.length === 0) {
                return;
            }

            const confirmacao = confirm('Deseja realmente limpar todos os assentos selecionados?');
            if (confirmacao) {
                assentosAtualmenteSelecionados.forEach(id => {
                    const assentoElement = document.querySelector(`.assento[data-id="${id}"]`);
                    if (assentoElement) {
                        assentoElement.classList.remove('selecionado');
                    }
                });
                assentosAtualmenteSelecionados = [];
                atualizarResumoCompra();
            }
        }


// INICIALIZAÇÃO                                     
       
        document.addEventListener('DOMContentLoaded', () => {
            gerarMapaAssentos();
            atualizarResumoCompra(); // Garante que o resumo inicial esteja correto
            
            // Adiciona eventos aos botões de ação
            btnFinalizarCompra.addEventListener('click', finalizarCompra);
            btnLimparSelecao.addEventListener('click', limparSelecao);
        });

    </script>

    </main>

    <footer>
      <p>Copyright © SEM PARADA | Centro Universitário Senac</p>
    </footer>
</body>
</html>